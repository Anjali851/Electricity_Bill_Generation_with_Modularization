<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net">
  <diagram name="Create Bill Flow">
    <mxGraphModel dx="1024" dy="768" grid="1" gridSize="10">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="start" value="Start" style="ellipse;fillColor=#dff7d8;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="80" y="40" width="100" height="40" as="geometry"/>
        </mxCell>

        <mxCell id="calc" value="Calculate units &amp; bill_price (calculate_tiered_bill)" style="rounded=1;fillColor=#fff2cc;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="220" y="40" width="280" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="last" value="Fetch last bill for service_no" style="rounded=1;fillColor=#e8f0fe;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="520" y="40" width="260" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="decision" value="Is last.status == 'unpaid'?" style="rhombus;fillColor=#ffe6e6;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="800" y="50" width="140" height="80" as="geometry"/>
        </mxCell>

        <mxCell id="setdues" value="prev_dues = last.total_bill; fine = 150" style="rounded=1;fillColor=#f0f8ff;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="980" y="20" width="220" height="40" as="geometry"/>
        </mxCell>

        <mxCell id="setnodues" value="prev_dues = 0; fine = 0" style="rounded=1;fillColor=#f0f8ff;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="980" y="90" width="220" height="40" as="geometry"/>
        </mxCell>

        <mxCell id="compute" value="total = bill_price + prev_dues + fine" style="rounded=1;fillColor=#fff2cc;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1220" y="50" width="260" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="insert" value="INSERT bill (status='unpaid')" style="rounded=1;fillColor=#e8ffe8;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1500" y="50" width="240" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="update" value="UPDATE customers SET curr_reading" style="rounded=1;fillColor=#fff2cc;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1780" y="50" width="240" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="end" value="Return bill object (success)" style="ellipse;fillColor=#dff7d8;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="2060" y="50" width="180" height="40" as="geometry"/>
        </mxCell>

        <!-- Connectors -->
        <mxCell id="c1" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;strokeColor=#000000" edge="1" parent="1" source="start" target="calc">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="c2" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;strokeColor=#000000" edge="1" parent="1" source="calc" target="last">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="c3" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;strokeColor=#000000" edge="1" parent="1" source="last" target="decision">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="c4" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;strokeColor=#000000" edge="1" parent="1" source="decision" target="setdues">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="c5" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;strokeColor=#000000" edge="1" parent="1" source="decision" target="setnodues">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="c6" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;strokeColor=#000000" edge="1" parent="1" source="setdues" target="compute">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="c7" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;strokeColor=#000000" edge="1" parent="1" source="setnodues" target="compute">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="c8" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;strokeColor=#000000" edge="1" parent="1" source="compute" target="insert">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="c9" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;strokeColor=#000000" edge="1" parent="1" source="insert" target="update">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="c10" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;strokeColor=#000000" edge="1" parent="1" source="update" target="end">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>